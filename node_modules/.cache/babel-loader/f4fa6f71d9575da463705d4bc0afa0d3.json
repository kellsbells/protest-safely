{"ast":null,"code":"let theMap;\nexport function showMap(lat, lng) {\n  mapElem = document.getElementById('map');\n  const position = {\n    lat,\n    lng\n  };\n  theMap = new google.maps.Map(mapElem, {\n    center: position,\n    zoom: 12\n  }); // window.markers = window.markers || [];\n  // const marker = new google.maps.Marker({ map, position });\n\n  renderMarkers();\n}\nexport function showDefaultMap() {\n  showMap(29.7392358, -104.990251);\n}\nexport function geolocate() {\n  if (window.navigator && window.navigator.geolocation) {\n    navigator.geolocation.getCurrentPosition(onGeolocateSuccess, onGeolocateError);\n  }\n\n  renderMarkers();\n}\nexport function onGeolocateSuccess(coordinates) {\n  hideGeolocateButton();\n  const {\n    latitude,\n    longitude\n  } = coordinates.coords;\n  showMap(latitude, longitude);\n}\nexport function onGeolocateError(error) {\n  hideGeolocateButton();\n  canGeolocate = false;\n\n  if (error.code === 1) {\n    console.log('User declined geolocation');\n  } else if (error.code === 2) {\n    console.log('Geolocation position unavailable');\n  } else if (error.code === 3) {\n    console.log('Timeout determining geolocation');\n  }\n}\nexport function hideGeolocateButton() {\n  geolocationHeader.remove();\n}\nexport function renderMarkers() {\n  console.log('inrenderMarkers');\n  return firebase.database().ref('/events/').once('value').then(function (data) {\n    let events = Object.values(data.val());\n    console.log('last event: ', events[events.length - 1]);\n    var icons = {\n      protest: {\n        peaceful: './images/protest-peaceful-icon.png',\n        intensifying: './images/protest-intensifying-icon.png',\n        dangerous: './images/protest-dangerous-icon.png'\n      },\n      police: {\n        peaceful: './images/police-peaceful-icon.png',\n        intensifying: './images/police-intensifying-icon.png',\n        dangerous: './images/police-dangerous-icon.png'\n      },\n      aid: {\n        icon: './images/aid-icon.png'\n      }\n    };\n\n    for (let i = 0; i < events.length; i++) {\n      let event = events[i];\n      let iconPath;\n\n      switch (events[i].type) {\n        case 'protest':\n          const demoLevel = events[i].formValues.demolevel;\n          iconPath = icons[events[i].type][demoLevel];\n          break;\n\n        case 'police':\n          const policeLevel = events[i].formValues.policelevel;\n          iconPath = icons[events[i].type][policeLevel];\n          break;\n\n        case 'aid':\n          iconPath = icons.aid.icon;\n      }\n\n      var image = {\n        url: iconPath,\n        size: new google.maps.Size(30, 30),\n        // The origin for this image is (0, 0).\n        origin: new google.maps.Point(0, 0),\n        // The anchor for this image is the base of the flagpole at (0, 32).\n        anchor: new google.maps.Point(0, 30)\n      };\n      var marker = new google.maps.Marker({\n        position: {\n          lat: event.lat,\n          lng: event.long\n        },\n        map: theMap,\n        icon: image,\n        zIndex: 2\n      });\n    }\n  });\n}\nexport function closeModal() {\n  addModal.classList.remove('show');\n  addModal.classList.add('hide');\n  setTimeout(function () {\n    renderMarkers();\n  }, 3000);\n  addInitial.classList.remove('show');\n  addInitial.classList.add('hide');\n  addProtestForm.classList.remove('show');\n  addProtestForm.classList.add('hide');\n  addPoliceForm.classList.remove('show');\n  addPoliceForm.classList.add('hide');\n  addAidForm.classList.remove('show');\n  addAidForm.classList.add('hide');\n}\nexport function openAddForm(event) {\n  event.stopPropagation();\n  addModal.classList.remove('hide');\n  addModal.classList.add('show');\n  addInitial.classList.add('show');\n  addInitial.classList.remove('hide');\n}\nexport function openAddProtest(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addProtestForm.classList.remove('hide');\n  addProtestForm.classList.add('show');\n}\nexport function openAddPolice(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addPoliceForm.classList.remove('hide');\n  addPoliceForm.classList.add('show');\n}\nexport function openAddAid(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addAidForm.classList.remove('hide');\n  addAidForm.classList.add('show');\n}\nexport function submitProtestEvent(event) {\n  event.preventDefault();\n  var demolevel = document.querySelector('input[name=\"demolevel\"]:checked').value;\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('protest', latitude, longitude, {\n      demolevel: demolevel\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function submitPoliceEvent(event) {\n  event.preventDefault();\n  console.log('in submitPoliceEvent');\n  var policelevel = document.querySelector('input[name=\"policelevel\"]:checked').value;\n  console.log('policelevel: ', policelevel);\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('police', latitude, longitude, {\n      policelevel: policelevel\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function submitAidEvent(event) {\n  event.preventDefault();\n  console.log('in submitProtestEvent');\n  var water = document.querySelector('input[name=\"water\"]').checked;\n  var food = document.querySelector('input[name=\"food\"]').checked;\n  var medical = document.querySelector('input[name=\"medical\"]').checked;\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('aid', latitude, longitude, {\n      water: water,\n      food: food,\n      medical: medical\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function writeNewEvent(type, lat, long, formValues) {\n  var postData = {\n    type: type,\n    lat: lat,\n    long: long,\n    formValues: formValues,\n    date: new Date()\n  };\n  var newPostKey = firebase.database().ref().child('events').push().key;\n  var updates = {};\n  updates['/events/' + newPostKey] = postData;\n  return firebase.database().ref().update(updates);\n}\nlet geolocateAvailable;\nlet geolocateButton;\nlet geolocationHeader;\nlet geolocateDecline;\nlet addButton;\nlet addModal;\nlet addProtest;\nlet addProtestForm;\nlet addPolice;\nlet addPoliceForm;\nlet addAid;\nlet addAidForm; // let database;\n\nlet canGeolocate = true;\nexport function initApp() {\n  console.log('initing app');\n  geolocateAvailable = window.navigator && window.navigator.geolocation;\n  geolocationHeader = document.getElementById('geolocation-header');\n  geolocateButton = document.getElementById('geolocation-button');\n  geolocateDecline = document.getElementById('geolocation-decline');\n  geolocateButton.disabled = true;\n  addButton = document.getElementById('actions-add');\n  addModal = document.getElementById('add-modal');\n  addInitial = document.querySelector('.add-initial');\n  addProtest = document.getElementById('add-protest');\n  addPolice = document.getElementById('add-police');\n  addAid = document.getElementById('add-aid');\n  addProtestForm = document.querySelector('.add-protest-form');\n  addPoliceForm = document.querySelector('.add-police-form');\n  addAidForm = document.querySelector('.add-aid-form');\n  showDefaultMap();\n\n  if (geolocateAvailable) {\n    geolocateButton.disabled = false;\n    geolocateButton.addEventListener('click', geolocate);\n    geolocateDecline.addEventListener('click', hideGeolocateButton);\n    addButton.addEventListener('click', openAddForm);\n    addProtest.addEventListener('click', openAddProtest);\n    addPolice.addEventListener('click', openAddPolice);\n    addAid.addEventListener('click', openAddAid);\n  }\n}","map":{"version":3,"sources":["/Users/vanessahenson/projects/protest-safely/src/map/scripts.js"],"names":["theMap","showMap","lat","lng","mapElem","document","getElementById","position","google","maps","Map","center","zoom","renderMarkers","showDefaultMap","geolocate","window","navigator","geolocation","getCurrentPosition","onGeolocateSuccess","onGeolocateError","coordinates","hideGeolocateButton","latitude","longitude","coords","error","canGeolocate","code","console","log","geolocationHeader","remove","firebase","database","ref","once","then","data","events","Object","values","val","length","icons","protest","peaceful","intensifying","dangerous","police","aid","icon","i","event","iconPath","type","demoLevel","formValues","demolevel","policeLevel","policelevel","image","url","size","Size","origin","Point","anchor","marker","Marker","long","map","zIndex","closeModal","addModal","classList","add","setTimeout","addInitial","addProtestForm","addPoliceForm","addAidForm","openAddForm","stopPropagation","openAddProtest","openAddPolice","openAddAid","submitProtestEvent","preventDefault","querySelector","value","writeNewEvent","submitPoliceEvent","submitAidEvent","water","checked","food","medical","postData","date","Date","newPostKey","child","push","key","updates","update","geolocateAvailable","geolocateButton","geolocateDecline","addButton","addProtest","addPolice","addAid","initApp","disabled","addEventListener"],"mappings":"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","sourcesContent":["let theMap;\n\nexport function showMap(lat, lng) {\n    mapElem = document.getElementById('map');\n    const position = { lat, lng };\n    theMap = new google.maps.Map(mapElem, {\n        center: position,\n        zoom: 12\n    });\n    // window.markers = window.markers || [];\n    // const marker = new google.maps.Marker({ map, position });\n    renderMarkers();\n}\n\nexport function showDefaultMap() {\n    showMap(29.7392358, -104.990251);\n}\n\nexport function geolocate() {\n    if (window.navigator && window.navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(onGeolocateSuccess, onGeolocateError);\n    }\n    renderMarkers();\n}\n\nexport function onGeolocateSuccess(coordinates) {\n    hideGeolocateButton();\n    const { latitude, longitude } = coordinates.coords;\n    showMap(latitude, longitude);\n}\n\nexport function onGeolocateError(error) {    \n    hideGeolocateButton();\n    canGeolocate = false;\n\n    if (error.code === 1) {\n        console.log('User declined geolocation');\n    } else if (error.code === 2) {\n        console.log('Geolocation position unavailable');\n    } else if (error.code === 3) {\n        console.log('Timeout determining geolocation');\n    }\n}\n\nexport function hideGeolocateButton() {\n    geolocationHeader.remove();\n}\n\nexport function renderMarkers () {\n    console.log('inrenderMarkers');\n    \n    return firebase.database().ref('/events/').once('value').then(function (data) {\n\n        let events = Object.values(data.val());\n        console.log('last event: ', events[events.length-1]);\n\n        var icons = {\n            protest: {\n                peaceful: './images/protest-peaceful-icon.png',\n                intensifying: './images/protest-intensifying-icon.png',\n                dangerous: './images/protest-dangerous-icon.png'\n            },\n            police: {\n                peaceful: './images/police-peaceful-icon.png',\n                intensifying: './images/police-intensifying-icon.png',\n                dangerous: './images/police-dangerous-icon.png'\n            },\n            aid: {\n                icon: './images/aid-icon.png'\n            }\n        };\n\n\n        for (let i = 0; i < events.length; i++) {\n            let event = events[i];\n            let iconPath;\n\n            switch (events[i].type) {\n                case 'protest':\n                    const demoLevel = events[i].formValues.demolevel\n                    iconPath = icons[events[i].type][demoLevel];\n                    break;\n                case 'police':\n                    const policeLevel = events[i].formValues.policelevel\n                    iconPath = icons[events[i].type][policeLevel];\n                    break;\n                case 'aid':\n                    iconPath = icons.aid.icon;\n            }\n\n            var image = {\n                url: iconPath,\n                size: new google.maps.Size(30, 30),\n                // The origin for this image is (0, 0).\n                origin: new google.maps.Point(0, 0),\n                // The anchor for this image is the base of the flagpole at (0, 32).\n                anchor: new google.maps.Point(0, 30)\n            };\n                    \n            var marker = new google.maps.Marker({\n                position: { lat: event.lat, lng: event.long },\n                map: theMap,\n                icon: image,\n                zIndex: 2,\n            });\n        }\n    });\n}\n\nexport function closeModal(){\n    addModal.classList.remove('show')\n    addModal.classList.add('hide');\n\n    setTimeout(function () { renderMarkers(); }, 3000);\n\n    addInitial.classList.remove('show');\n    addInitial.classList.add('hide');\n    addProtestForm.classList.remove('show');\n    addProtestForm.classList.add('hide');\n    addPoliceForm.classList.remove('show');\n    addPoliceForm.classList.add('hide');\n    addAidForm.classList.remove('show');\n    addAidForm.classList.add('hide');\n}\n\nexport function openAddForm(event){\n    event.stopPropagation();\n    addModal.classList.remove('hide')\n    addModal.classList.add('show');\n    addInitial.classList.add('show');\n    addInitial.classList.remove('hide');\n}\n\nexport function openAddProtest(event){\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addProtestForm.classList.remove('hide');\n    addProtestForm.classList.add('show');\n}\n\nexport function openAddPolice(event) {\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addPoliceForm.classList.remove('hide');\n    addPoliceForm.classList.add('show');\n}\n\nexport function openAddAid(event) {\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addAidForm.classList.remove('hide');\n    addAidForm.classList.add('show');\n}\n\nexport function submitProtestEvent(event) {\n    event.preventDefault();\n    var demolevel = document.querySelector('input[name=\"demolevel\"]:checked').value;\n    navigator.geolocation.getCurrentPosition(function (coordinates) {\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('protest', latitude, longitude, {\n            demolevel: demolevel,\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\nexport function submitPoliceEvent(event){\n    event.preventDefault();\n    console.log('in submitPoliceEvent');\n    var policelevel = document.querySelector('input[name=\"policelevel\"]:checked').value;\n    console.log('policelevel: ', policelevel);\n    navigator.geolocation.getCurrentPosition(function (coordinates) {\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('police', latitude, longitude, {\n            policelevel: policelevel,\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\nexport function submitAidEvent(event) {\n    event.preventDefault();\n    console.log('in submitProtestEvent');\n    var water = document.querySelector('input[name=\"water\"]').checked;\n    var food = document.querySelector('input[name=\"food\"]').checked;\n    var medical = document.querySelector('input[name=\"medical\"]').checked;\n\n    navigator.geolocation.getCurrentPosition(function(coordinates){\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('aid', latitude, longitude, {\n            water: water,\n            food: food,\n            medical: medical\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\n\nexport function writeNewEvent(type, lat, long, formValues) {\n    var postData = {\n        type: type,\n        lat: lat,\n        long: long,\n        formValues: formValues,\n        date: new Date()\n    };\n    var newPostKey = firebase.database().ref().child('events').push().key;\n    var updates = {};\n    updates['/events/' + newPostKey] = postData;\n    return firebase.database().ref().update(updates);\n}\n\nlet geolocateAvailable;\nlet geolocateButton;\nlet geolocationHeader;\nlet geolocateDecline;\nlet addButton;\nlet addModal;\nlet addProtest;\nlet addProtestForm;\nlet addPolice;\nlet addPoliceForm;\nlet addAid;\nlet addAidForm;\n\n// let database;\nlet canGeolocate = true;\n\nexport function initApp () {\n    console.log('initing app');\n    geolocateAvailable = window.navigator && window.navigator.geolocation;\n    geolocationHeader = document.getElementById('geolocation-header');\n    geolocateButton = document.getElementById('geolocation-button');\n    geolocateDecline = document.getElementById('geolocation-decline');\n    geolocateButton.disabled = true\n    addButton = document.getElementById('actions-add');\n    addModal = document.getElementById('add-modal');\n    addInitial = document.querySelector('.add-initial');\n    addProtest = document.getElementById('add-protest');\n    addPolice = document.getElementById('add-police');\n    addAid = document.getElementById('add-aid');\n    addProtestForm = document.querySelector('.add-protest-form');\n    addPoliceForm = document.querySelector('.add-police-form');\n    addAidForm = document.querySelector('.add-aid-form');\n\n    showDefaultMap();\n\n    if (geolocateAvailable) {\n        geolocateButton.disabled = false;\n\n        geolocateButton.addEventListener('click', geolocate);\n        geolocateDecline.addEventListener('click', hideGeolocateButton);\n\n        addButton.addEventListener('click', openAddForm);\n        addProtest.addEventListener('click', openAddProtest);\n        addPolice.addEventListener('click', openAddPolice);\n        addAid.addEventListener('click', openAddAid);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}