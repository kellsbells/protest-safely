{"ast":null,"code":"let theMap; // export function showMap(lat, lng) {\n//     mapElem = document.getElementById('map');\n//     const position = { lat, lng };\n//     theMap = new google.maps.Map(mapElem, {\n//         center: position,\n//         zoom: 12\n//     });\n//     // window.markers = window.markers || [];\n//     // const marker = new google.maps.Marker({ map, position });\n//     renderMarkers();\n// }\n// export function showDefaultMap() {\n//     showMap(29.7392358, -104.990251);\n// }\n\nexport function geolocate() {\n  if (window.navigator && window.navigator.geolocation) {\n    navigator.geolocation.getCurrentPosition(onGeolocateSuccess, onGeolocateError);\n  }\n\n  renderMarkers();\n}\nexport function onGeolocateSuccess(coordinates) {\n  hideGeolocateButton();\n  const {\n    latitude,\n    longitude\n  } = coordinates.coords;\n  showMap(latitude, longitude);\n}\nexport function onGeolocateError(error) {\n  hideGeolocateButton();\n  canGeolocate = false;\n\n  if (error.code === 1) {\n    console.log('User declined geolocation');\n  } else if (error.code === 2) {\n    console.log('Geolocation position unavailable');\n  } else if (error.code === 3) {\n    console.log('Timeout determining geolocation');\n  }\n}\nexport function hideGeolocateButton() {\n  geolocationHeader.remove();\n}\nexport function renderMarkers() {\n  console.log('inrenderMarkers');\n  return firebase.database().ref('/events/').once('value').then(function (data) {\n    let events = Object.values(data.val());\n    console.log('last event: ', events[events.length - 1]);\n    var icons = {\n      protest: {\n        peaceful: './images/protest-peaceful-icon.png',\n        intensifying: './images/protest-intensifying-icon.png',\n        dangerous: './images/protest-dangerous-icon.png'\n      },\n      police: {\n        peaceful: './images/police-peaceful-icon.png',\n        intensifying: './images/police-intensifying-icon.png',\n        dangerous: './images/police-dangerous-icon.png'\n      },\n      aid: {\n        icon: './images/aid-icon.png'\n      }\n    };\n\n    for (let i = 0; i < events.length; i++) {\n      let event = events[i];\n      let iconPath;\n\n      switch (events[i].type) {\n        case 'protest':\n          const demoLevel = events[i].formValues.demolevel;\n          iconPath = icons[events[i].type][demoLevel];\n          break;\n\n        case 'police':\n          const policeLevel = events[i].formValues.policelevel;\n          iconPath = icons[events[i].type][policeLevel];\n          break;\n\n        case 'aid':\n          iconPath = icons.aid.icon;\n      }\n\n      var image = {\n        url: iconPath,\n        size: new google.maps.Size(30, 30),\n        // The origin for this image is (0, 0).\n        origin: new google.maps.Point(0, 0),\n        // The anchor for this image is the base of the flagpole at (0, 32).\n        anchor: new google.maps.Point(0, 30)\n      };\n      var marker = new google.maps.Marker({\n        position: {\n          lat: event.lat,\n          lng: event.long\n        },\n        map: theMap,\n        icon: image,\n        zIndex: 2\n      });\n    }\n  });\n}\nexport function closeModal() {\n  addModal.classList.remove('show');\n  addModal.classList.add('hide');\n  setTimeout(function () {\n    renderMarkers();\n  }, 3000);\n  addInitial.classList.remove('show');\n  addInitial.classList.add('hide');\n  addProtestForm.classList.remove('show');\n  addProtestForm.classList.add('hide');\n  addPoliceForm.classList.remove('show');\n  addPoliceForm.classList.add('hide');\n  addAidForm.classList.remove('show');\n  addAidForm.classList.add('hide');\n}\nexport function openAddForm(event) {\n  event.stopPropagation();\n  addModal.classList.remove('hide');\n  addModal.classList.add('show');\n  addInitial.classList.add('show');\n  addInitial.classList.remove('hide');\n}\nexport function openAddProtest(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addProtestForm.classList.remove('hide');\n  addProtestForm.classList.add('show');\n}\nexport function openAddPolice(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addPoliceForm.classList.remove('hide');\n  addPoliceForm.classList.add('show');\n}\nexport function openAddAid(event) {\n  event.stopPropagation();\n  addInitial.classList.add('hide');\n  addInitial.classList.remove('show');\n  addAidForm.classList.remove('hide');\n  addAidForm.classList.add('show');\n}\nexport function submitProtestEvent(event) {\n  event.preventDefault();\n  var demolevel = document.querySelector('input[name=\"demolevel\"]:checked').value;\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('protest', latitude, longitude, {\n      demolevel: demolevel\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function submitPoliceEvent(event) {\n  event.preventDefault();\n  console.log('in submitPoliceEvent');\n  var policelevel = document.querySelector('input[name=\"policelevel\"]:checked').value;\n  console.log('policelevel: ', policelevel);\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('police', latitude, longitude, {\n      policelevel: policelevel\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function submitAidEvent(event) {\n  event.preventDefault();\n  console.log('in submitProtestEvent');\n  var water = document.querySelector('input[name=\"water\"]').checked;\n  var food = document.querySelector('input[name=\"food\"]').checked;\n  var medical = document.querySelector('input[name=\"medical\"]').checked;\n  navigator.geolocation.getCurrentPosition(function (coordinates) {\n    const {\n      latitude,\n      longitude\n    } = coordinates.coords;\n    writeNewEvent('aid', latitude, longitude, {\n      water: water,\n      food: food,\n      medical: medical\n    });\n  }, onGeolocateError);\n  closeModal();\n}\nexport function writeNewEvent(type, lat, long, formValues) {\n  var postData = {\n    type: type,\n    lat: lat,\n    long: long,\n    formValues: formValues,\n    date: new Date()\n  };\n  var newPostKey = firebase.database().ref().child('events').push().key;\n  var updates = {};\n  updates['/events/' + newPostKey] = postData;\n  return firebase.database().ref().update(updates);\n}\nlet geolocateAvailable;\nlet geolocateButton;\nlet geolocationHeader;\nlet geolocateDecline;\nlet addButton;\nlet addModal;\nlet addProtest;\nlet addProtestForm;\nlet addPolice;\nlet addPoliceForm;\nlet addAid;\nlet addAidForm; // let database;\n\nlet canGeolocate = true;\nexport function initApp() {\n  console.log('initing app');\n  geolocateAvailable = window.navigator && window.navigator.geolocation;\n  geolocationHeader = document.getElementById('geolocation-header');\n  geolocateButton = document.getElementById('geolocation-button');\n  geolocateDecline = document.getElementById('geolocation-decline');\n  geolocateButton.disabled = true;\n  addButton = document.getElementById('actions-add');\n  addModal = document.getElementById('add-modal');\n  addInitial = document.querySelector('.add-initial');\n  addProtest = document.getElementById('add-protest');\n  addPolice = document.getElementById('add-police');\n  addAid = document.getElementById('add-aid');\n  addProtestForm = document.querySelector('.add-protest-form');\n  addPoliceForm = document.querySelector('.add-police-form');\n  addAidForm = document.querySelector('.add-aid-form');\n  showDefaultMap();\n\n  if (geolocateAvailable) {\n    geolocateButton.disabled = false;\n    geolocateButton.addEventListener('click', geolocate);\n    geolocateDecline.addEventListener('click', hideGeolocateButton);\n    addButton.addEventListener('click', openAddForm);\n    addProtest.addEventListener('click', openAddProtest);\n    addPolice.addEventListener('click', openAddPolice);\n    addAid.addEventListener('click', openAddAid);\n  }\n}","map":{"version":3,"sources":["/Users/vanessahenson/projects/protest-safely/src/map/scripts.js"],"names":["theMap","geolocate","window","navigator","geolocation","getCurrentPosition","onGeolocateSuccess","onGeolocateError","renderMarkers","coordinates","hideGeolocateButton","latitude","longitude","coords","showMap","error","canGeolocate","code","console","log","geolocationHeader","remove","firebase","database","ref","once","then","data","events","Object","values","val","length","icons","protest","peaceful","intensifying","dangerous","police","aid","icon","i","event","iconPath","type","demoLevel","formValues","demolevel","policeLevel","policelevel","image","url","size","google","maps","Size","origin","Point","anchor","marker","Marker","position","lat","lng","long","map","zIndex","closeModal","addModal","classList","add","setTimeout","addInitial","addProtestForm","addPoliceForm","addAidForm","openAddForm","stopPropagation","openAddProtest","openAddPolice","openAddAid","submitProtestEvent","preventDefault","document","querySelector","value","writeNewEvent","submitPoliceEvent","submitAidEvent","water","checked","food","medical","postData","date","Date","newPostKey","child","push","key","updates","update","geolocateAvailable","geolocateButton","geolocateDecline","addButton","addProtest","addPolice","addAid","initApp","getElementById","disabled","showDefaultMap","addEventListener"],"mappings":"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","sourcesContent":["let theMap;\n\n// export function showMap(lat, lng) {\n//     mapElem = document.getElementById('map');\n//     const position = { lat, lng };\n//     theMap = new google.maps.Map(mapElem, {\n//         center: position,\n//         zoom: 12\n//     });\n//     // window.markers = window.markers || [];\n//     // const marker = new google.maps.Marker({ map, position });\n//     renderMarkers();\n// }\n\n// export function showDefaultMap() {\n//     showMap(29.7392358, -104.990251);\n// }\n\nexport function geolocate() {\n    if (window.navigator && window.navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(onGeolocateSuccess, onGeolocateError);\n    }\n    renderMarkers();\n}\n\nexport function onGeolocateSuccess(coordinates) {\n    hideGeolocateButton();\n    const { latitude, longitude } = coordinates.coords;\n    showMap(latitude, longitude);\n}\n\nexport function onGeolocateError(error) {    \n    hideGeolocateButton();\n    canGeolocate = false;\n\n    if (error.code === 1) {\n        console.log('User declined geolocation');\n    } else if (error.code === 2) {\n        console.log('Geolocation position unavailable');\n    } else if (error.code === 3) {\n        console.log('Timeout determining geolocation');\n    }\n}\n\nexport function hideGeolocateButton() {\n    geolocationHeader.remove();\n}\n\nexport function renderMarkers () {\n    console.log('inrenderMarkers');\n    \n    return firebase.database().ref('/events/').once('value').then(function (data) {\n\n        let events = Object.values(data.val());\n        console.log('last event: ', events[events.length-1]);\n\n        var icons = {\n            protest: {\n                peaceful: './images/protest-peaceful-icon.png',\n                intensifying: './images/protest-intensifying-icon.png',\n                dangerous: './images/protest-dangerous-icon.png'\n            },\n            police: {\n                peaceful: './images/police-peaceful-icon.png',\n                intensifying: './images/police-intensifying-icon.png',\n                dangerous: './images/police-dangerous-icon.png'\n            },\n            aid: {\n                icon: './images/aid-icon.png'\n            }\n        };\n\n\n        for (let i = 0; i < events.length; i++) {\n            let event = events[i];\n            let iconPath;\n\n            switch (events[i].type) {\n                case 'protest':\n                    const demoLevel = events[i].formValues.demolevel\n                    iconPath = icons[events[i].type][demoLevel];\n                    break;\n                case 'police':\n                    const policeLevel = events[i].formValues.policelevel\n                    iconPath = icons[events[i].type][policeLevel];\n                    break;\n                case 'aid':\n                    iconPath = icons.aid.icon;\n            }\n\n            var image = {\n                url: iconPath,\n                size: new google.maps.Size(30, 30),\n                // The origin for this image is (0, 0).\n                origin: new google.maps.Point(0, 0),\n                // The anchor for this image is the base of the flagpole at (0, 32).\n                anchor: new google.maps.Point(0, 30)\n            };\n                    \n            var marker = new google.maps.Marker({\n                position: { lat: event.lat, lng: event.long },\n                map: theMap,\n                icon: image,\n                zIndex: 2,\n            });\n        }\n    });\n}\n\nexport function closeModal(){\n    addModal.classList.remove('show')\n    addModal.classList.add('hide');\n\n    setTimeout(function () { renderMarkers(); }, 3000);\n\n    addInitial.classList.remove('show');\n    addInitial.classList.add('hide');\n    addProtestForm.classList.remove('show');\n    addProtestForm.classList.add('hide');\n    addPoliceForm.classList.remove('show');\n    addPoliceForm.classList.add('hide');\n    addAidForm.classList.remove('show');\n    addAidForm.classList.add('hide');\n}\n\nexport function openAddForm(event){\n    event.stopPropagation();\n    addModal.classList.remove('hide')\n    addModal.classList.add('show');\n    addInitial.classList.add('show');\n    addInitial.classList.remove('hide');\n}\n\nexport function openAddProtest(event){\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addProtestForm.classList.remove('hide');\n    addProtestForm.classList.add('show');\n}\n\nexport function openAddPolice(event) {\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addPoliceForm.classList.remove('hide');\n    addPoliceForm.classList.add('show');\n}\n\nexport function openAddAid(event) {\n    event.stopPropagation();\n    addInitial.classList.add('hide');\n    addInitial.classList.remove('show');\n    addAidForm.classList.remove('hide');\n    addAidForm.classList.add('show');\n}\n\nexport function submitProtestEvent(event) {\n    event.preventDefault();\n    var demolevel = document.querySelector('input[name=\"demolevel\"]:checked').value;\n    navigator.geolocation.getCurrentPosition(function (coordinates) {\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('protest', latitude, longitude, {\n            demolevel: demolevel,\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\nexport function submitPoliceEvent(event){\n    event.preventDefault();\n    console.log('in submitPoliceEvent');\n    var policelevel = document.querySelector('input[name=\"policelevel\"]:checked').value;\n    console.log('policelevel: ', policelevel);\n    navigator.geolocation.getCurrentPosition(function (coordinates) {\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('police', latitude, longitude, {\n            policelevel: policelevel,\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\nexport function submitAidEvent(event) {\n    event.preventDefault();\n    console.log('in submitProtestEvent');\n    var water = document.querySelector('input[name=\"water\"]').checked;\n    var food = document.querySelector('input[name=\"food\"]').checked;\n    var medical = document.querySelector('input[name=\"medical\"]').checked;\n\n    navigator.geolocation.getCurrentPosition(function(coordinates){\n        const { latitude, longitude } = coordinates.coords;\n        writeNewEvent('aid', latitude, longitude, {\n            water: water,\n            food: food,\n            medical: medical\n        });\n    }, onGeolocateError);\n    closeModal();\n}\n\n\nexport function writeNewEvent(type, lat, long, formValues) {\n    var postData = {\n        type: type,\n        lat: lat,\n        long: long,\n        formValues: formValues,\n        date: new Date()\n    };\n    var newPostKey = firebase.database().ref().child('events').push().key;\n    var updates = {};\n    updates['/events/' + newPostKey] = postData;\n    return firebase.database().ref().update(updates);\n}\n\nlet geolocateAvailable;\nlet geolocateButton;\nlet geolocationHeader;\nlet geolocateDecline;\nlet addButton;\nlet addModal;\nlet addProtest;\nlet addProtestForm;\nlet addPolice;\nlet addPoliceForm;\nlet addAid;\nlet addAidForm;\n\n// let database;\nlet canGeolocate = true;\n\nexport function initApp () {\n    console.log('initing app');\n    geolocateAvailable = window.navigator && window.navigator.geolocation;\n    geolocationHeader = document.getElementById('geolocation-header');\n    geolocateButton = document.getElementById('geolocation-button');\n    geolocateDecline = document.getElementById('geolocation-decline');\n    geolocateButton.disabled = true\n    addButton = document.getElementById('actions-add');\n    addModal = document.getElementById('add-modal');\n    addInitial = document.querySelector('.add-initial');\n    addProtest = document.getElementById('add-protest');\n    addPolice = document.getElementById('add-police');\n    addAid = document.getElementById('add-aid');\n    addProtestForm = document.querySelector('.add-protest-form');\n    addPoliceForm = document.querySelector('.add-police-form');\n    addAidForm = document.querySelector('.add-aid-form');\n\n    showDefaultMap();\n\n    if (geolocateAvailable) {\n        geolocateButton.disabled = false;\n\n        geolocateButton.addEventListener('click', geolocate);\n        geolocateDecline.addEventListener('click', hideGeolocateButton);\n\n        addButton.addEventListener('click', openAddForm);\n        addProtest.addEventListener('click', openAddProtest);\n        addPolice.addEventListener('click', openAddPolice);\n        addAid.addEventListener('click', openAddAid);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}